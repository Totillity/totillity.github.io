<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Book</title>
    
        <link rel='stylesheet' href='../../style.css'>
    
</head>
<body>
    <input type="checkbox" class="nav-bar-side-checkbox" id="nav-bar-side-button">
    <div class="nav-bar-side">
        <div class="nav-bar">
            <div id="nav-title-container">
    <!--            <div id="nav-title">Navigation</div>-->
                <img src="/Logo.svg" id="nav-img">
            </div>

            <div class="nav-list">
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/index.html">Contents</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        
                            <input type="checkbox" class="nav-checkbox" id="nav-checkbox-1-2" checked="checked">
                        
                        <div class="nav-bar-dropdown-container">
                            <label class="nav-label" for="nav-checkbox-1-2">
                                <span class="nav-dropdown-label-span">
                                    JIT Project
                                </span>
                            </label>
                            <div class="nav-dropdown-content">
                                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/about.html">About</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        
                            <input type="checkbox" class="nav-checkbox" id="nav-checkbox-2-2" checked="checked">
                        
                        <div class="nav-bar-dropdown-container">
                            <label class="nav-label" for="nav-checkbox-2-2">
                                <span class="nav-dropdown-label-span">
                                    Progress Timeline
                                </span>
                            </label>
                            <div class="nav-dropdown-content">
                                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/timeline.html">Timeline</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/week-1-3.html">Weeks 1 to 3</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/journal-1.html">Journal 1</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/week-4-7.html">Weeks 4 to 7</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/journal-2.html">Journal 2</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/week-8-13.html">Weeks 8 to 13</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/journal-3.html">Journal 3</a>
                    
                    </div>
                
                    <div class="nav-bar-item">
                    
                        <a class="nav-link" href="/jit-project/progress-timeline/week-14-16.html">Weeks 14 to 16</a>
                    
                    </div>
                
                            </div>
                        </div>
                    
                    </div>
                
                            </div>
                        </div>
                    
                    </div>
                
            </div>
        </div>
        <label class="nav-bar-side-label" for="nav-bar-side-button">
            <span class="nav-bar-side-label-span"></span>
        </label>
    </div>
    <div class="content-container">
        <div class="content">
            <div class="content-title"><header>Journal 3: Weeks 8-13</header></div><hr><div class="content-paragraph"><p>January 15, 2020 - February 27, 2021</p></div><div class="content-heading">Goals for this Journal:</div><ol class="content-ordered-list"><li class="content-ordered-list-item"><div class="content-paragraph"><p>Research some non-JIT optimization techniques</p></div></li><li class="content-ordered-list-item"><div class="content-paragraph"><p>Research some JIT specific optimization techniques</p></div></li><li class="content-ordered-list-item"><div class="content-paragraph"><p>Whenever I find one I want to implement, do so</p></div></li><li class="content-ordered-list-item"><div class="content-paragraph"><p>Implemented include: Dead Code Elimination, Constant Folding, Instruction Emission Optimization</p></div></li></ol><div class="content-heading">Research</div><div class="content-paragraph"><p>
<b>Note: all references labelled at the bottom.</b>
<b>Note: I used code snippets instead of screenshots because this is a programming project.</b>
<b>Note: I used pseudocode instead of actual C for the sake of clarity.</b></p></div><div class="content-paragraph"><p>Originally, this journal was to be primarily focused on my initial efforts to implement the parts of a JIT that make it a JIT.
However, there is an issue with that: those parts don't work until I do some preliminary work that makes it more of an AOT compiler
than a jit. Therefore, this journal will cover the AOT optimization techniques I've implemented, and the initial work to implement
the JIT part.</p></div><div class="content-paragraph"><p>First, I'll explain the basic idea of code optimization. Say a programmer wrote this code:   
</p></div><div class="content-code"><pre>
def foo() {
    a = 7 * 3
    b = a + 4
    c = b + a
    return c
}
</pre></div><div class="content-paragraph"><p>
It is very easy for a human to see that all this work of addition and multiplication doesn't need to be done everytime
this code is run. The loads, multiplications, additions, and stores would create a lot of extra work that doesn't need to be
done. Rather, the following code would have the exact same end result, but would run significantly faster:
</p></div><div class="content-code"><pre>
def foo() {
    return 46
}
</pre></div><div class="content-paragraph"><p>
This change has removed 3 variables and 3 operations, making it an excellent <i>optimization</i>. As you've probably guessed,
an optimization is simply any change to a program which makes it have the same result, but use less of some valuable resource,
such as time, I/O, or memory. A compiler optimization is any routine within the compiler which attempts to optimize the code it
is given in some particular way. An optimization is a particular strategy to optimize code.
</p></div><div class="content-paragraph"><p>
The hard part of all this, of course, is getting a computer to understand a program well enough that it can make it better.
This can be an extremely challenging thing to do, if you do it naively. Take the following code: 
</p></div><div class="content-code"><pre>
def bar() {
    x = 7 + 2
    y = x * 2 + x
    x = y - 3
    z = x * y - y
    return z + x
}
</pre></div><div class="content-paragraph"><p>
Say you create an optimization where, whenever an arithmetic operation is applied to two constants and assigned to a variable (think 
<span class="nowrap"><code>a = 3 - 2</code></span> or <span class="nowrap"><code>k = 55 / 5</code></span>),
you replace all usages of that variable with the result of said arithmetic operation. You then apply that optimization to the above code once, 
getting:  
</p></div><div class="content-code"><pre>
def bar() {
    // we know x = 7 + 2 = 9, so we remove the assignments to x and replace its usages with 9
    y = 9 * 2 + 9
    // this line (x = y - 3) can be removed, right???
    z = 9 * y - y
    return z + 9
}
</pre></div><div class="content-paragraph"><p>
You might have seen the problem. Halfway through the function, we assign to x again, this time with a possibly different value.
Any usages of x after that point have to refer to a different value. We can't just naively replace variables whenever we want.
<i>Or can we?</i>
</p></div><div class="content-paragraph"><p>
SSA is a solution to this problem. It stands for Static Single Assignment form, but only the 'Single Assignment' part is what we care about.
In SSA form, all variables are assigned to only once. The function I've shown above would not be a valid SSA program, because
x is assigned to twice. However, it is fairly trivial to convert a non-SSA program to SSA form. Whenever you would assign to a variable
for the second time, like in the <span class="nowrap"><code>x = y - 3</code></span> line, instead assign to a new variable and replace all future occurrences of the
original variable with the new one. For example, here's the previous function converted to SSA form:
</p></div><div class="content-code"><pre>
def bar() {
    x = 7 + 2
    y = x * 2 + x
    x1 = y - 3
    z = x1 * y - y
    return z + x1
}
</pre></div><div class="content-paragraph"><p>
As you can see, the x1's solve the problem of the same variable having different values in different parts of the program
Now, replacing variables with what we know is their constant value is much easier, especially for
the dumb computer. This shows just some of the value of SSA form. Now let's go over some optimizations. 
</p></div><div class="content-paragraph"><p>
<b>Constant Folding</b> is one of the simplest optimizations to understand, as it's the one I've been using as an example.
It's just replacing operations we know are on constants with their known result. Usually, multiple passes of this optimization are 
advisable. After just one iteration of <span class="nowrap"><code>bar</code></span> from above (replacing x), it becomes:
</p></div><div class="content-code"><pre>
def bar() {
    y = 9 * 2 + 9
    x1 = y - 3
    z = x1 * y - y
    return z + x1
}
</pre></div><div class="content-paragraph"><p>
Knowing that more optimizations can be performed, we do a second iteration on the new code generated, replacing y, so it becomes: 
</p></div><div class="content-code"><pre>
def bar() {
    x1 = 18 - 3
    z = x1 * 18 - 18
    return z + x1
}
</pre></div><div class="content-paragraph"><p>
We can now replace x1, which makes our third iteration: 
</p></div><div class="content-code"><pre>
def bar() {
    z = 15 * 18 - 18
    return z + 15
}
</pre></div><div class="content-paragraph"><p>
Finally, on the 4th iterations, we've removed all variables and calculations: 
</p></div><div class="content-code"><pre>
def bar() {
    return 267
}
</pre></div><div class="content-paragraph"><p>
Constant folding has converted a function with lots of variables, operations, and general overhead into a near-zero cost function.
To actually execute this optimization, we just recognize whenever both arguments to an arithmetic operation 
</p></div><div class="content-paragraph"><p>
Constant folding has converted a function with lots of variables, operations, and general overhead into a near-zero cost function. 
</p></div><div class="content-heading">Reflection</div><div class="content-paragraph"><p></p></div><div class="content-paragraph"><p></p></div><div class="content-heading">Main Accomplishments</div><ol class="content-ordered-list"></ol><div class="content-heading">Sources:</div><ol class="content-ordered-list"></ol><div class="content-end"></div>
        </div>
    </div>
    <div class="right-content"></div>
</body>
</html>